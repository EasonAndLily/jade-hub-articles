# 康威定律

![Conway Law](https://s1.locimg.com/2024/02/14/be0e92a0df9e2.jpeg)

“康威定律”是1976年由计算机科学家梅尔康威(Melvin Conway)提出的:

>The structure of a system is determined by the communication patterns of the people who design it.
>
>设计系统的架构受制于产生这些设计的组织的沟通结构。

康威定律可谓软件架构设计中的第一定律，起初只是在杂志上的发表，后经过《人月神话》这本软件界圣经的引用，并命名为康威定律（Conway’s law），因此得以推广。

康威定律简单理解就是：***你想设计什么样的软件架构，就先设计什么样的组织结构！***

康威定律对软件产品的指导意义重大，其精髓可以用四个定律来拆解：
1. **第一定律 组织沟通方式会通过系统设计表达出来。**
2. **第二定律 时间再多一件事情也不可能做的完美，但总有时间做完一件事情。**
3. **第三定律 线型系统和线型组织架构间有潜在的异质同态特性。**
4. **第四定律 大的系统组织总是比小系统更倾向于分解。**

## 四大定律

#### 第一定律：组织沟通方式会通过系统设计表达出来

比如《人月神话》中最著名的一句话就是：
> Adding manpower to a late software project makes it later --Fred Brooks, (1975)

为了赶进度加程序员就像用水去灭油锅里的火一样，为什么？人月神话也给出了很简洁的答案：**沟通成本 = n(n-1)/2**，沟通成本随着项目或者组织的人员增加呈指数级增长。

人是复杂的社会动物，组织的沟通和系统的设计之间紧密相连，特别是复杂系统，解决好人与人的沟通才能有一个更好的系统设计。

沟通的问题会带来系统设计的问题，进而影响整个系统的开发效率和最终产品结果。这也是为什么互联网公司都追求小团队的原因之一。

举个例子：2008 年，艾伦·D·麦科马克（Alan D. MacCormack）、约翰·鲁斯纳克（John Rusnak）和卡莉斯·Y·鲍德温（Cariss Y. Baldwin）对“镜像”假设进行了测试[2]：
> ***与紧密耦合的组织相比，松散耦合的组织倾向于开发更为模块化的产品。***

他们在研究中分析了功能相同但由两种相反的组织模式构建的软件，商业（紧耦合）和开源（松耦合）。他们使用一种称为设计结构矩阵（DSMs，Design Structure Matrices）的技术来可视化不同软件的架构，通过计算度量来比较它们的模块化级别。结果显示在模块化方面两者表现出显著的差异。

![conway_law_1](https://s1.locimg.com/2024/02/14/eee616f420694.webp)

在商业组织中，开发团队在一起工作，通过面对面的交互来解决问题，由于可以很方便的找到其他模块的开发人员，他们可以实现性能的最优化。因此自然而然的，生产出了紧密耦合（如左图）的软件。

在开源组织中，大多数开发人员很少或从不见面。由于通信有限，因此模块化的好处更大。软件需要模块化（如图所示），这样贡献者才能很容易的理解设计，以便开发新特性或修复缺陷，而不会影响系统的其他部分。

#### 第二定律：时间再多一件事情也不可能做的完美，但总有时间做完一件事情

人手永远是不够的，事情永远是做不完的，但可以一件一件来。这不就是软件行业中“敏捷开发”模式所解决的问题吗。面对这样的状况，敏捷开发可以做到不断迭代、持续交付、快速验证和反馈，并持续改进。

几个开发人员的小公司，去追求微服务、去追求中台架构，这是追求完美吗？不是，是找死。

在系统真正地投入生产使用之前，再好的架构都只是假设，产品越晚被使用者使用，失败的成本和风险就越高，而小步行进，通过MVP快速实验，获取客户反馈，迭代演化产品，能有效地减少失败的成本和风险。

另外，多年的经验告诉我，架构，平台不是买来的，也不是用一个开源就能获得的，也不是设计出来，而是长期演化才能落地生根的。

#### 第三定律：线型系统和线型组织架构间有潜在的异质同态特性

这是第一定律组织和设计间内在关系的一个具体应用。更直白的说，你想要什么样的系统，就搭建什么样的团队。如果你的团队分成前端团队，java后台开发团队，DBA团队，运维团队，你的系统就会长成下面的样子：

![fontend backend team](https://s1.locimg.com/2024/02/14/60fd69a4a305d.jpg)

相反，如果你的系统按照业务边界划分的，大家按照一个业务目标去把自己的模块做成小系统，小产品的话，你的大系统就会成长成下面的样子，即微服务的架构:

![mirco service team](https://s1.locimg.com/2024/02/14/ff7b0c2d0b6c4.png)

微服务的团队间应该是 inter-operate, not integrate 。 inter-operate 是定义好系统的边界和接口，在一个团队内全栈，让团队自治，原因就是因为如果团队按照这样的方式组建，将沟通的成本维持在系统内部，每个子系统就会更加内聚，彼此的依赖耦合变弱，跨系统的沟通成本也就能减低。

#### 第四定律：大的系统组织总是比小系统更倾向于分解

《三国演义》里面经典的论述：天下大势，分久必合，合久必分。系统越复杂，越需要增加人手，人手越多，沟通成本也呈指数增长。分而治之便是大多数公司选择的解决方案。分不同的层级，分不同的小团队，让团队内部完成自治理，然后统一对外沟通。

架构不仅仅需要技术，在大公司尤其需要政治，所谓的架构的政治。正如杨波老师曾在他的文章《每个架构师都应该研究下康威定律》中提到：

> “政治指的是和他人协作将事情搞定的艺术，架构是一种社交活动，在技术的世界里，个人主义很容易被打败，即使你的目的是好的技术是最优的，技术决策是政治决策（technical decisions are political decisions），一个技术产品，一波人可以做，另一波人也可以做，到底谁做的好，真不好说，不管谁做，都给业务套上了一副手铐。”
>
> 我刚入软件开发这个行业之初，谈的架构主要是性能，高可用等等。现在，见过无数遗留系统，特别是国内企业 IT 的现状，无数高耦合的遗留系统，不良的架构像手铐一样牢牢地限制住业务，升级替换成本非常巨大， 所以我更加关注可理解，可维护性，可扩展性，成本 。我想补充一句，创业公司创业之初获得好的架构师或技术 CTO 非常重要。

## 康威定律的指导意义

康威定律的意义在于提醒我们，在设计系统时要考虑到组织结构对系统设计的影响，并尽可能地将组织结构与系统结构相匹配，以便更好地管理和维护系统。

具体来看，对于架构师来说，思维和眼光就不能仅仅局限在技术和业务上面，架构师的职责是在利益相关者(Stakeholders)之间取得微妙的平衡, 系统架构的目标是解决利益相关者的关注点。架构系统前，架构师的首要任务是尽最大可能找出所有利益相关者，业务方，产品经理，客户 / 用户，开发经理，工程师，项目经理，测试人员，运维人员，产品运营人员等等都有可能是利益相关者，架构师要充分和利益相关者沟通，深入理解他们的关注点和痛点，并出架构解决这些关注点。然后根据这些关注点和沟通路径，设计系统架构。

特别需要注意的是，如果架构师设计的系统和组织的沟通路径不一致时，取胜的一定是组织结构！

### 谷仓效应的危害

前面我们介绍了谷仓效应，也了解了谷仓效应的危害，但是从康威定律的角度来看，谷仓效应会制约软件架构的设计，使得软件从根本上就无法满足用户的需求，而架构师却对此无能为力！

请看下面这幅图，请你思考一下，对于“职能竖井式组织”中的软件架构会是什么样子呢？

![functional silo](https://s1.locimg.com/2024/02/13/e1bd45b74812f.jpg)

## 逆康威定律

这是ThoughtWorks技术总监James Lewis突发奇想地提出的，组织要根据他们想得到的软件架构来设计团队结构，而不是期望团队盲从一个被设计好的团队结构。该定律是康威定律的反向论证，也为软件团队的组织结构搭建提供了新的思路：不要期望设计一个良好的组织结构你应该先考虑你的软件架构，让组织结构匹配你的软件架构！

其核心观点在于，将软件架构看作一个独立的概念，认为它可以被孤立设计，然后交由任何团队来实现，这从根本上就是错误的。这个点我们在前面已经论述了。

所以，人们可以通过按照康威定律以可能产生该系统架构的方式构建组织来实现所需的系统架构。
